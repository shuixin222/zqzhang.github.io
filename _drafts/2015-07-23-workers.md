---
layout: post
type: post
title: Worker
---

# 本文试图解答几个小问题

* Service Workers 是什么？它能解决哪些问题？
* Service Workers 和 Web Workers 有关系吗？
* Service Workers 真能取代 HTML5 AppCache？
* Service Workers 现状如何？Intel 有哪些贡献？

先来看看业界是如何评说：

> [Service Workers 让 Web 应用感觉更像是原生应用](http://www.infoq.com/cn/news/2014/12/service-workers-make-web-native) by David Iffland，王沛。

> [The ServiceWorker: The network layer is yours to own](https://www.youtube.com/watch?v=4uQMl7mFB6g) by Jake Archibald.

> [Service worker is a game-changing API that will allow for the development of new types of web applications](http://blog.pluralsight.com/introduction-to-service-worker) by Alex Mackey.


# Service Workers 是什么？

> 简单的说 Service Workers 就是一个生命周期短暂的、事件驱动的后台线程，它处理来自系统和被其控制的页面的事件。[WebApp与Native App再战一轮？](http://tech.163.com/15/0709/09/AU2R65MF000948V8.html)

> At their simplest, Service Workers are scripts that act as client-side proxies for web pages. [ServiceWorkers and Firefox](https://hacks.mozilla.org/2014/06/serviceworkers-and-firefox/)

> A service worker is a method that enables applications to take advantage of persistent background processing, including hooks to enable bootstrapping of web applications while offline. [Service Workers -- W3C Working Draft 25 June 2015](http://www.w3.org/TR/2015/WD-service-workers-20150625/)


# Service Workers 和 Web Workers 有关系吗？

> A service worker is a type of web worker. The core of this system is an event-driven Web Worker, which responds to events dispatched from documents and other sources. A system for managing installation, versions, and upgrades is provided. [Service Workers -- W3C Working Draft 25 June 2015](http://www.w3.org/TR/2015/WD-service-workers-20150625/)

> The service worker is like a shared worker, but whereas pages control a shared worker, a service worker controls pages. [Service Worker - first draft published](http://jakearchibald.com/2014/service-worker-first-draft/)

> Web Worker 可以在后台运行，但是它依赖于页面，不能在页面不存在的时候运行。[WebApp与Native App再战一轮？](http://tech.163.com/15/0709/09/AU2R65MF000948V8.html)

[Dedicated Worker 示例](https://whatwg.org/demos/workers/primes/page.html):

~~~
<!-- page.html -->
<!DOCTYPE HTML>
<html>
 <head>
  <title>Worker example: One-core computation</title>
 </head>
 <body>
  <p>The highest prime number discovered so far is: <output id="result"></output></p>
  <script>
   var worker = new Worker('worker.js');
   worker.onmessage = function (event) {
     document.getElementById('result').textContent = event.data;
   };
  </script>
 </body>
</html>

/* worker.js */
var n = 1;
search: while (true) {
  n += 1;
  for (var i = 2; i <= Math.sqrt(n); i += 1)
    if (n % i == 0)
     continue search;
  // found a prime!
  postMessage(n);
}
~~~

[Shared Worker 示例](https://whatwg.org/demos/workers/shared/001/test.html):

~~~
<!-- test.html -->
<!DOCTYPE HTML>
<title>Shared workers: demo 1</title>
<pre id="log">Log:</pre>
<script>
  var worker = new SharedWorker('test.js');
  var log = document.getElementById('log');
  worker.port.onmessage = function(e) { // note: not worker.onmessage!
    log.textContent += '\n' + e.data;
  }
</script>

/* test.js */
onconnect = function(e) {
  var port = e.ports[0];
  port.postMessage('Hello World!');
}
~~~


# Service Workers 能做啥？

> 现在 service worker 的最佳使用场景是提供离线能力。开发人员可以注册一个 service worker 作为网络代理提供网络拦截。即使没有可用的网络时，这个代理也能够对缓存的数据和资源或者是已经生成的内容作出响应。[Service Workers 让 Web 应用感觉更像是原生应用](http://www.infoq.com/cn/news/2014/12/service-workers-make-web-native)

> 目前可以通过 Service Worker 实现的功能包括：替代坑坑洼洼的 Application Cache 的可编程离线缓存，Push Notification（消息推送），Background Sync（后台同步）。Service Worker 能成为诸多需要跨越页面处理能力的入口。比如如果你怀念 Web Intents 的话，Service Worker 也许也能成为它复活的平台：通过 Service Worker 注册某个 intent 事件，在事件到来时 worker 被启动，针对不同的 intent worker 可以选择打开不同的页面或重新聚焦某个已经打开的页面。

# Service Workers 真能取代 HTML5 AppCache？

> 和现有的 HTML5 数据缓存功能有很大的不同，service worker 的离线能力是可编程的。Russell 称它是一个：“让你做出选择去做哪些事的、可编程的、浏览器内置的代理”。由于 service worker 运行于后台，它和当前的 Web 页面完全独立，所以将来会有后台同步、推送通知等功能。[Service Workers 让 Web 应用感觉更像是原生应用](http://www.infoq.com/cn/news/2014/12/service-workers-make-web-native)

[HTML5 AppCache 示例](https://whatwg.org/demos/offline/clock/live-demo/clock.html):

~~~
<!-- clock.html -->
<!DOCTYPE HTML>
<html manifest="clock.appcache">
 <head>
  <title>Clock</title>
  <script src="clock.js"></script>
  <link rel="stylesheet" href="clock.css">
 </head>
 <body>
  <p>The time is: <output id="clock"></output></p>
 </body>
</html>

/* clock.css */
output { font: 2em sans-serif; }

/* clock.js */
setInterval(function () {
    document.getElementById('clock').value = new Date();
}, 1000);

"clock.appcache"
CACHE MANIFEST
clock.html
clock.css
clock.js
~~~

# Service Workers 的功能都被实现了吗？

且看 Service Workers “之父” Jake Archibald 所写的 [Is Service Worker Ready](https://jakearchibald.github.io/isserviceworkerready/)。
